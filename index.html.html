
<!DOCTYPE html>
<html>
<head>
    <title>Tunnel AI Surrogate V3</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0e1117; color: #fafafa; padding: 20px; display: flex; justify-content: center; }
        .main-layout { display: flex; gap: 40px; max-width: 1000px; width: 100%; flex-wrap: wrap; }
        
        .controls { flex: 1; background: #1e1e1e; padding: 25px; border-radius: 12px; min-width: 320px; }
        .visuals { flex: 1; background: #1e1e1e; padding: 25px; border-radius: 12px; min-width: 320px; display: flex; flex-direction: column; align-items: center; }
        
        .slider-group { margin-bottom: 15px; }
        input[type=range] { width: 100%; cursor: pointer; accent-color: #3498db; }
        .label-row { display: flex; justify-content: space-between; font-size: 0.9rem; color: #bbb; margin-bottom: 5px; }
        .val { color: #fff; font-weight: bold; }
        
        .metric-row { display: flex; gap: 15px; width: 100%; margin-bottom: 20px; }
        .metric-card { background: #2b2b2b; padding: 15px; border-radius: 8px; flex: 1; text-align: center; border-left: 5px solid #555; }
        .metric-val { font-size: 1.8rem; font-weight: bold; margin-top: 5px; }
        .metric-title { font-size: 0.8rem; text-transform: uppercase; color: #888; }
        
        .tunnel-window { 
            width: 300px; height: 300px; background: #111; 
            border-radius: 10px; position: relative; overflow: hidden; 
            border: 2px solid #333; margin-top: 20px;
        }
        .ground { width: 100%; height: 100%; background: #2b2b2b; position: absolute; }
        #tunnel-svg { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        
        #collapse-overlay { 
            display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); color: #e74c3c; 
            flex-direction: column; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: bold; z-index: 10;
        }
    </style>
</head>
<body>

    <div class="main-layout">
        <div class="controls">
            <h2 style="margin-top:0">üéõÔ∏è Design Parameters</h2>
            <hr style="border-color: #333; margin-bottom: 20px;">
            
            <div class="slider-group"><div class="label-row"><label>Young's Modulus (E)</label><span class="val" id="v0">10 GPa</span></div><input type="range" id="i0" min="5" max="30" step="1" value="10" oninput="runAI()"></div>
            <div class="slider-group"><div class="label-row"><label>Cohesion (c)</label><span class="val" id="v1">1.0 MPa</span></div><input type="range" id="i1" min="0.1" max="2.0" step="0.1" value="1.0" oninput="runAI()"></div>
            <div class="slider-group"><div class="label-row"><label>Friction Angle (œÜ)</label><span class="val" id="v2">30¬∞</span></div><input type="range" id="i2" min="20" max="35" step="1" value="30" oninput="runAI()"></div>
            <div class="slider-group"><div class="label-row"><label>In-situ Stress (œÉ‚ÇÄ)</label><span class="val" id="v4">10 MPa</span></div><input type="range" id="i4" min="2" max="20" step="0.5" value="10" oninput="runAI()"></div>
            <div class="slider-group"><div class="label-row"><label>Tunnel Depth</label><span class="val" id="v5">200 m</span></div><input type="range" id="i5" min="50" max="600" step="10" value="200" oninput="runAI()"></div>
            <div class="slider-group"><div class="label-row"><label>Support Thickness</label><span class="val" id="v6">20 cm</span></div><input type="range" id="i6" min="5" max="40" step="1" value="20" oninput="runAI()"></div>
        </div>

        <div class="visuals">
            <div class="metric-row">
                <div class="metric-card" id="card-fos"><div class="metric-title">Factor of Safety</div><div class="metric-val" id="out-fos">1.50</div></div>
                <div class="metric-card" style="border-left-color: #3498db;"><div class="metric-title">Displacement</div><div class="metric-val" id="out-disp">12 mm</div></div>
            </div>

            <div id="status-text" style="color: #2ecc71; font-weight: bold;">STABLE</div>

            <div class="tunnel-window">
                <div class="ground"></div>
                <svg id="tunnel-svg" viewBox="0 0 100 100">
                    <circle id="tunnel-circle" cx="50" cy="50" r="30" fill="#111" stroke="#555" stroke-width="2" />
                    <circle id="tunnel-liner" cx="50" cy="50" r="28" fill="none" stroke="#2ecc71" stroke-width="4" />
                    <path id="cracks" d="M 20 20 L 40 40 M 80 20 L 60 40 M 50 10 L 50 30" stroke="#e74c3c" stroke-width="3" fill="none" opacity="0"/>
                </svg>
                <div id="collapse-overlay"><span>‚ö†Ô∏è COLLAPSE</span><span style="font-size:1rem; color:white; margin-top:10px">Failure Detected</span></div>
            </div>
        </div>
    </div>

    <script>
        const W = {"min": [5.007981471021481, 0.10026254659472991, 20.00792433236095, 20.00351774398808, 2.003244343492601, 50.99862384795025, 5.024526430619908], "max": [29.969082913505446, 1.9991740902886277, 34.99706842258239, 26.987999549286187, 19.993674117124925, 599.9413284857523, 39.96521398551404], "disp_w": [-41.173152059897795, -1.1542610832468387, 2.595905017968466, 3.872758715934154, 82.39920537482077, 86.24433621777644, -49.07238730148571], "disp_b": 8.729631666657738, "fos_w": [-0.028532199653419747, 0.8069868813368093, 0.13174574326225996, -0.025934857058642513, -1.7984244179783033, -0.014212181081241892, 0.28643873230889694], "fos_b": 1.1755328050188307};

        function runAI() {
            let inputs = [
                parseFloat(document.getElementById('i0').value),
                parseFloat(document.getElementById('i1').value),
                parseFloat(document.getElementById('i2').value),
                24.0, 
                parseFloat(document.getElementById('i4').value),
                parseFloat(document.getElementById('i5').value),
                parseFloat(document.getElementById('i6').value)
            ];

            // Update Labels
            ['v0','v1','v2'].forEach((id, i) => document.getElementById(id).innerText = inputs[i]);
            document.getElementById('v4').innerText = inputs[4] + " MPa";
            document.getElementById('v5').innerText = inputs[5] + " m";
            document.getElementById('v6').innerText = inputs[6] + " cm";

            // Predict
            let x = inputs.map((v, i) => (v - W.min[i]) / (W.max[i] - W.min[i]));
            let disp = W.disp_b;
            let fos = W.fos_b;
            for(let k=0; k<7; k++) { disp += x[k] * W.disp_w[k]; fos += x[k] * W.fos_w[k]; }

            if(disp < 0) disp = 0;
            document.getElementById('out-disp').innerText = disp.toFixed(1) + " mm";
            document.getElementById('out-fos').innerText = fos.toFixed(2);

            // Animation Logic
            let liner = document.getElementById('tunnel-liner');
            let cracks = document.getElementById('cracks');
            let overlay = document.getElementById('collapse-overlay');
            let status = document.getElementById('status-text');
            let cardFos = document.getElementById('card-fos');

            overlay.style.display = "none";
            cracks.style.opacity = "0";

            // Deform tunnel based on displacement
            let def = Math.min(disp, 100);
            let scaleY = 1.0 - (def / 200); 
            let scaleX = 1.0 + (def / 300);

            // FIXED LINE: Note the double brackets above, but here we use JS template literal
            liner.setAttribute("transform", `translate(50, 50) scale(${scaleX}, ${scaleY}) translate(-50, -50)`);

            if (fos < 1.0) {
                status.innerText = "CRITICAL FAILURE";
                status.style.color = "#e74c3c";
                cardFos.style.borderLeftColor = "#e74c3c";
                liner.setAttribute("stroke", "#e74c3c");
                cracks.style.opacity = "1";
                overlay.style.display = "flex";
            } else if (fos < 1.3) {
                status.innerText = "WARNING: UNSTABLE";
                status.style.color = "#f39c12";
                cardFos.style.borderLeftColor = "#f39c12";
                liner.setAttribute("stroke", "#f39c12");
            } else {
                status.innerText = "STABLE DESIGN";
                status.style.color = "#2ecc71";
                cardFos.style.borderLeftColor = "#2ecc71";
                liner.setAttribute("stroke", "#2ecc71");
            }
        }
        runAI();
    </script>
</body>
</html>
